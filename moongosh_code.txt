// super-simple-crud.js
// Super-simple Mongoose CRUD demo â€” step by step.
// 1) npm install mongoose
// 2) Make sure MongoDB (mongod) is running locally
// 3) node super-simple-crud.js

const mongoose = require('mongoose');

async function run() {
  // STEP 1 - Connect
  await mongoose.connect('mongodb://127.0.0.1:27017/simple_crud_demo');
  console.log('STEP 1 âœ… connected');

  // STEP 2 - Schema + Model (simple validations)
  const userSchema = new mongoose.Schema({
    name:  { type: String, required: true, minlength: 2 },
    email: { type: String, required: true, match: /.+\@.+\..+/ },
    age:   { type: Number, min: 18 }
  });
  const User = mongoose.model('User', userSchema);
  console.log('STEP 2 âœ… schema & model ready');

  // STEP 3 - Clean (start fresh)
  await User.deleteMany({});
  console.log('STEP 3 âœ… cleaned demo collection');

  // STEP 4 - CREATE (single) - simple and validates automatically
  const a = await User.create({ name: 'Shakti', email: 'shakti@example.com', age: 23 });
  console.log('STEP 4 âœ… created single:', a.name);

  // STEP 5 - CREATE (many) - bulk insert
  const many = [
    { name: 'Amit', email: 'amit@example.com', age: 30 },
    { name: 'Neha', email: 'neha@example.com', age: 28 }
  ];
  const inserted = await User.insertMany(many);
  console.log('STEP 5 âœ… inserted many:', inserted.map(u => u.name).join(', '));

  // STEP 6 - READ (find)
  const all = await User.find(); // array of docs
  console.log('STEP 6 âœ… find all count:', all.length);

  const one = await User.findOne({ email: 'shakti@example.com' }); // single doc
  console.log('STEP 6 âœ… findOne:', one ? one.name : 'not found');

  const byId = await User.findById(one._id); // by _id
  console.log('STEP 6 âœ… findById email:', byId.email);

  // STEP 7 - UPDATE (runValidators: true enforces schema rules on updates)
  await User.updateOne({ name: 'Shakti' }, { $set: { age: 24 } }, { runValidators: true });
  console.log('STEP 7 âœ… updateOne done (age -> 24)');

  const updated = await User.findOneAndUpdate(
    { email: 'shakti@example.com' },
    { $set: { age: 25 } },
    { new: true, runValidators: true } // new:true returns updated doc
  );
  console.log('STEP 7 âœ… findOneAndUpdate new age:', updated.age);

  // STEP 8 - DELETE
  const del = await User.deleteOne({ name: 'Amit' });
  console.log('STEP 8 âœ… deleteOne removed count:', del.deletedCount);

  // delete by id example (delete Neha)
  const neha = await User.findOne({ name: 'Neha' });
  if (neha) {
    const delById = await User.findByIdAndDelete(neha._id);
    console.log('STEP 8 âœ… findByIdAndDelete removed:', delById.name);
  }

  // STEP 9 - Final list and disconnect
  const remaining = await User.find();
  console.log('STEP 9 âœ… remaining users:', remaining.map(u => u.name).join(', '));

  await mongoose.disconnect();
  console.log('DONE âœ… disconnected');
}

run().catch(err => {
  console.error('ERROR:', err.message);
  process.exit(1);
});


/// expample same as upper
Mongoose CRUD Documentation (Simple Notes)

1. Mongo vs Mongosh
- mongo â†’ old shell (deprecated, not supported).
- mongosh â†’ new shell, modern, supports all features. Use this.

2. Connect
- mongoose.connect("mongodb://127.0.0.1:27017/dbname")
ğŸ‘‰ Connects Node.js app to MongoDB database.

3. Schema
- Schema = blueprint for how documents will look.
- Defines fields, types, and rules (validations).
Example:
const userSchema = new mongoose.Schema({
  name: { type: String, required: true },
  age: { type: Number, min: 18 }
});

4. Model
- Model = collection handler created from schema.
- Used to perform CRUD operations.
Example:
const User = mongoose.model("User", userSchema);

5. Create (Insert)
- Add documents into collection.
- Methods:
  - save() â†’ insert one document.
  - create() â†’ insert one or multiple.
  - insertMany() â†’ bulk insert.

6. Read (Find)
- Get documents from collection.
- Methods:
  - find() â†’ returns array of docs.
  - findOne() â†’ returns first match.
  - findById(id) â†’ returns document by _id.

7. Update
- Modify documents in collection.
- Methods:
  - updateOne(filter, update, { runValidators:true }) â†’ update first match.
  - updateMany() â†’ update multiple docs.
  - findOneAndUpdate(filter, update, { new:true, runValidators:true }) â†’ update and return updated doc.
  - findByIdAndUpdate(id, update, { new:true, runValidators:true }) â†’ update by ID.
âš ï¸ By default updates do NOT validate schema â†’ use { runValidators:true }.

8. Delete
- Remove documents from collection.
- Methods:
  - deleteOne(filter) â†’ delete first match.
  - deleteMany(filter) â†’ delete all matches.
  - findOneAndDelete(filter) â†’ delete and return doc.
  - findByIdAndDelete(id) â†’ delete by ID and return doc.

9. Schema Validations (Common)
- required: true â†’ must have a value.
- min / max â†’ number range.
- minlength / maxlength â†’ string length.
- enum â†’ only specific values allowed.
- match â†’ regex pattern (e.g. email).
- default â†’ default value if not given.
- unique â†’ makes field unique (creates DB index).

10. Quick Flow
1. Connect â†’ mongoose.connect()
2. Schema â†’ define structure
3. Model â†’ create collection handler
4. Create â†’ add documents
5. Read â†’ get documents
6. Update â†’ change documents (with { runValidators:true })
7. Delete â†’ remove documents
8. Disconnect â†’ mongoose.disconnect()
